
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Login Page</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>


  <script type="text/javascript">
  $(document).ready(function() {
	    $('#beneficiaryList').DataTable();
	} );
  
  function savepayeeviaAPI(){
	  var inputvo = {};//text boxes
	  inputvo.id =$("#payeeId").val();//getting from hidden text,get and setting into inputvo
	  inputvo.payeeAccountNo=$("#payeeAccountNo").val();
	  inputvo.payeeNickName=$("#payeeNickName").val();
	  inputvo.remarks=$("#remarks").val();
	  inputvo.payeeName=$("#payeeName").val();
	  
	  var jsonData = JSON.stringify(inputvo);//converting into JSON ,passeed inputvo and convert
	  const input ={
			 method:'POST',
			 body :jsonData,
			headers:{
				'Content-Type':'application/json',//passed 
				'Accept':'application/json'
			}
	  };
	  console.log("input-----"+input);
	  
	  fetch("http://localhost:999/v3/customer/editPayee/",input)//calling api, fetch and passed all the values in input parameters
	  .then((resp)=> resp.json())
	  .then(data=>{//all the data are here
		  console.log(data);
	 $("#removeMessage").html(data.message);//make new blue edit message
	 $("#editPayee").modal("hide");
	  });
	  
  }
  
  function deletePayee(payeeId){
	  fetch("http://localhost:999/v3/customer/deletePayee/"+payeeId)
	  .then((resp)=> resp.json())
	  .then(data=>{
		  console.log(data);
	 $("#removeMessage").html(data.message);
	 $("#row_"+payeeId).hide();
	  }); 
	  
  }
  function editPayeeDummy(payeeId,payeeName,payeeNickname,payeeAC,remarks){
	  $("#payeeId").val(payeeId);
	  $("#payeeName").val(payeeName);//setter method
	  $("#payeeNickName").val(payeeNickname);
	  $("#payeeAccountNo").val(payeeAC);
	  $("#remarks").val(remarks);
	  $("#editPayee").modal("show");
  }
  
  function editPayee(payeeId,payeeName,payeeNickname,payeeAC,remarks){//values are already present in the html
	  fetch("http://localhost:999/v3/customer/findPayee/"+payeeId)
	  .then((resp)=> resp.json())
	  .then(data=>{
		  console.log(data);
		  $("#payeeId").val(data.id);//setting id
		  $("#payeeName").val(data.payeeName);//textboxes so val
		  $("#payeeNickName").val(data.payeeNickName);
		  $("#payeeAccountNo").val(data.payeeAccountNo);
		  $("#remarks").val(data.remarks);
		  $("#editPayee").modal("show");
	  }); 
  
  }
  </script>

  <style>
.ffooter {
  position: fixed;
  left: 0;
  bottom: 0;
  width: 100%;
  background-color: red;
  color: white;
  text-align: center;
  height: 30px;
  background-color:#e9ffe7;
}
</style>
</head>
<body>
<header style="height: 30px;background-color: maroon;color:white;">
  Hello Mr. <span th:utext="${session.userSessionVO.username}" th:unless="${session == null}" style="font-weight: bold;"></span>

</header>
<div class="container">
  <h2>Beneficairy List 
  </h2>
  <a th:href="@{/customer/addPayee}"> 
    <button type="button" class="btn btn-success">Add new Payee</button>
    </a>
<a th:href="@{/customer/logout}"> 
<button type="button" class="btn btn-warning">Logout</button>
</a>
   <span th:utext="${error}" style="color: red;font-size: 18px;"></span>
      <span id="removeMessage" style="color: red;font-size: 18px;font-weight:bold;"></span>
   
   <hr/>
  <div th:if="${payeeInfoVO != null}"  style="width: 100%">
    <table id="enquiryList" class="table table-striped table-bordered" style="width:100%">
  <thead>
  <tr style="color:blue" >
  <th> Payee Name </th>
  <th> Payee Nickname</th>
  <th> Account Number </th>
  <th> Remarks </th>
  <th> Edit </th>
    <th> Delete </th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="payeeInfo: ${payeeInfoVO}" th:id="'row_'+ ${payeeInfo.id}">
  	<td th:text="${payeeInfo.payeeName}"/>
  	<td th:text="${payeeInfo.payeeNickName}"/>
  	<td th:text="${payeeInfo.payeeAccountNo}"/>
  	<td th:text="${payeeInfo.remarks}"/>
  
  	<td>
  	<button type="button" id ="edit"th:value="${payeeInfo.id}" th:onclick="|editPayee('${payeeInfo.id}','${payeeInfo.payeeName}','${payeeInfo.payeeNickName}','${payeeInfo.payeeAccountNo}','${payeeInfo.remarks}')|"class="btn btn-success">Edit</button>
  	</td>
  	<td>

  	<button type="button"id ="delete" th:onclick="|deletePayee('${payeeInfo.id}')|"class="btn btn-danger">Delete</button>
  	</td>

  </tr>
  </tbody>
  </table>
<!-- Modal started!!!!!!!! -->
  </div>
   <div th:unless="${payeeInfoVO!= null}"  style="width: 100%">
  <span th:utext="Don't have beneficiary" style="color: blue;font-size: 18px;"></span>
  </div>
  <div class="modal" id="editPayee">
   <div class="modal-dialog">
    <div class="modal-content">
    <!-- Modal header started -->
       <div class="modal-header">
        <h4 class="modal-title">Edit Payee</h4>
           <button type= "button" class="close" data-dismiss="modal">&times;</button>
       </div>
    <br>
  <!-- Modal body -->  
       <div class="modal-body">
         <form action="#" method="post" th:action="@{/customer/editPayeeInfo}">
            <input type="hidden" class="form-control" id="payeeId" name="id"/>
               <label>Payee Name</label>
                 <input type="text" class="form-control" name ="payeeName" id="payeeName"> 
                 <label>Payee Nickname</label>
                 <input type="text" class="form-control" name ="payeeNickName" id="payeeNickName"> 
                  <label>Payee AccountNumber</label>
                 <input type="text" class="form-control" name ="payeeAccountNo" id="payeeAccountNo"> 
                  <label>Remarks</label>
                 <input type="text" class="form-control" name ="remarks" id="remarks"> 
                 
           <br>
           <button type="submit" class="btn btn-primary">Update</button>
            </form>
     		 <button type= "button" class="btn btn-success" onclick="savepayeeviaAPI()">Edit Payee</button>
		</div> 

<!-- Modal footer -->  
            <div class="footer">
                 <button type="button" class="bt btn-danger" data-dismiss="modal">Close</button>
             </div>
        </div> 
   </div>
  </div>
</div>
<footer  class="ffooter">
</footer>

</body>
</html>